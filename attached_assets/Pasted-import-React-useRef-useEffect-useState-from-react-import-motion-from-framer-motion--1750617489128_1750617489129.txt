import React, { useRef, useEffect, useState } from 'react';
import { motion } from 'framer-motion';

interface Service {
  title: string;
  videoFile: string;
  description: string;
  keywords: string[];
}

interface VideoCardProps {
  service: Service;
  index: number;
}

const VideoCard: React.FC<VideoCardProps> = ({ service, index }) => {
  const videoRef = useRef<HTMLVideoElement>(null);
  const [isVisible, setIsVisible] = useState(true);
  const [isLoaded, setIsLoaded] = useState(false);

  const handleVideoLoad = () => {
    console.log("Video loaded:", service.title);
    setIsLoaded(true);
  };

  const handleVideoError = (error: any) => {
    console.error("Video error for", service.title, ":", error);
  };

  return (
    <motion.div 
      initial={{ opacity: 0, y: 20 }}
      animate={{ opacity: 1, y: 0 }}
      transition={{ duration: 0.5, delay: index * 0.1 }}
      className="group relative bg-white rounded-2xl overflow-hidden shadow-lg hover:shadow-xl transition-all duration-300 hover:-translate-y-1"
    >
      {/* Video Container - NO GAP */}
      <div className="relative h-48 md:h-56 overflow-hidden bg-gray-100">
        {/* Loading Spinner */}
        {!isLoaded && (
          <div className="absolute inset-0 bg-gradient-to-br from-green-100 to-green-200 flex items-center justify-center z-10">
            <div className="w-12 h-12 border-4 border-green-500 border-t-transparent rounded-full animate-spin"></div>
          </div>
        )}
        
        {/* Video Element with proper rounded corners */}
        <video
          ref={videoRef}
          className={`w-full h-full object-contain rounded-t-2xl transition-opacity duration-300 ${
            isLoaded ? 'opacity-100' : 'opacity-0'
          }`}
          autoPlay
          muted
          loop
          playsInline
          onLoadedData={handleVideoLoad}
          onError={handleVideoError}
          onCanPlay={() => console.log("Video can play:", service.title)}
          onLoadStart={() => console.log("Video load start:", service.title)}
        >
          <source src={`/videos/${service.videoFile}`} type="video/mp4" />
        </video>
        
        {/* Hover Overlay */}
        <motion.div 
          className="absolute inset-0 bg-gradient-to-t from-black/20 to-transparent rounded-t-2xl"
          initial={{ opacity: 0 }}
          whileHover={{ opacity: 1 }}
          transition={{ duration: 0.3 }}
        />
      </div>

      {/* Content - ZERO GAP, PERFECT ALIGNMENT */}
      <div className="px-6 py-6">
        <h3 className="text-xl font-bold text-gray-900 group-hover:text-green-600 transition-colors mb-4 m-0">
          {service.title}
        </h3>
        
        <p className="text-gray-600 text-sm leading-relaxed mb-6 m-0">
          {service.description}
        </p>

        {/* Service Tags */}
        <div className="flex flex-wrap gap-2">
          {service.keywords.map((keyword, idx) => (
            <span 
              key={idx}
              className="text-xs bg-gray-100 text-gray-600 px-3 py-1 rounded-md hover:bg-green-50 hover:text-green-700 transition-colors"
            >
              {keyword}
            </span>
          ))}
        </div>
      </div>
    </motion.div>
  );
};

const VideoServicesSection: React.FC = () => {
  const services: Service[] = [
    {
      title: "Bag Repair",
      videoFile: "bags repair.mp4",
      description: "Professional leather and fabric bag restoration services in Palmer Heights, PA. We repair handles, zippers, stitching, and structural damage on handbags, backpacks, and luxury purses. Our expert craftsmen use premium materials and traditional techniques to restore your favorite bags to like-new condition.",
      keywords: ["bag repair", "handbag restoration", "zipper repair", "leather bags"]
    },
    {
      title: "Custom Orders",
      videoFile: "custom orders.mp4", 
      description: "Bespoke shoe and leather goods crafting services tailored to your exact specifications. From custom orthotics and shoe modifications to personalized watch straps and unique leather accessories, we create one-of-a-kind pieces that perfectly match your style and functional needs.",
      keywords: ["custom shoes", "bespoke leather", "personalized accessories", "made to order"]
    },
    {
      title: "Eyeglass Repair",
      videoFile: "eyeglass repair.mp4",
      description: "Fast and reliable eyewear repair services including frame welding, lens replacement, nose pad adjustment, and temple repair. We work with all frame materials - metal, plastic, titanium, and designer frames. Most repairs completed while you wait at our Palmer Heights location.",
      keywords: ["eyeglass repair", "frame repair", "lens replacement", "glasses fix"]
    },
    {
      title: "Sneaker Cleaning", 
      videoFile: "sneaker cleaning.mp4",
      description: "Professional deep cleaning and restoration for all types of athletic footwear. Our specialized cleaning process removes dirt, stains, and odors while preserving the integrity of premium materials like suede, nubuck, and mesh. We restore your favorite sneakers to pristine condition.",
      keywords: ["sneaker cleaning", "shoe cleaning", "athletic shoe care", "sneaker restoration"]
    },
    {
      title: "Watch Repair",
      videoFile: "watch repair.mp4", 
      description: "Expert timepiece repair and maintenance services for mechanical, automatic, and quartz watches. We handle battery replacement, movement cleaning, crystal replacement, band repair, and water resistance testing. Certified repair for luxury and vintage watch brands.",
      keywords: ["watch repair", "timepiece service", "battery replacement", "watch maintenance"]
    },
    {
      title: "Waterproofing Leather",
      videoFile: "waterproofing leather.mp4",
      description: "Professional leather protection and waterproofing treatments to extend the life of your shoes, boots, and leather goods. We apply premium protective coatings that repel water and stains while maintaining the natural look and feel of your leather items.",
      keywords: ["leather waterproofing", "shoe protection", "leather treatment", "weatherproofing"]
    }
  ];

  return (
    <section className="py-16 px-4 bg-gray-50">
      <div className="max-w-7xl mx-auto">
        {/* Section Header */}
        <motion.div 
          className="text-center mb-12"
          initial={{ opacity: 0, y: 30 }}
          animate={{ opacity: 1, y: 0 }}
          transition={{ duration: 0.6 }}
        >
          <h2 className="text-4xl md:text-5xl font-bold text-gray-900 mb-4" style={{ fontFamily: 'Playfair Display, serif' }}>
            Our Services
          </h2>
          <p className="text-xl text-gray-600 max-w-3xl mx-auto">
            Quality craftsmanship and reliable service for all your repair needs
          </p>
        </motion.div>

        {/* Bento Grid - 1 col mobile → 3 col tablet/desktop for 3×2 layout */}
        <div className="grid grid-cols-1 md:grid-cols-3 gap-6 lg:gap-8">
          {services.map((service, index) => (
            <VideoCard 
              key={service.title}
              service={service} 
              index={index}
            />
          ))}
        </div>

        {/* CTA */}
        <motion.div 
          className="text-center mt-12"
          initial={{ opacity: 0 }}
          animate={{ opacity: 1 }}
          transition={{ duration: 0.6, delay: 0.8 }}
        >
          <motion.button 
            className="bg-[#00783e] hover:bg-[#005530] text-white px-8 py-3 rounded-lg font-semibold transition-colors duration-200 shadow-lg hover:shadow-xl"
            whileHover={{ scale: 1.05 }}
            whileTap={{ scale: 0.95 }}
          >
            Get Your Free Estimate
          </motion.button>
        </motion.div>
      </div>
    </section>
  );
};

export default VideoServicesSection;